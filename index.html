<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Garnett Work — Verify with Confidence</title>

  <style>
    :root{
      --bg0:#000;
      --panel: rgba(18,18,22,0.72);
      --border: rgba(255,255,255,0.08);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.65);
      --gold: rgba(255,215,0,0.95);
      --gold2: rgba(255,215,0,0.78);
      --shadow: 0 18px 50px rgba(0,0,0,0.6);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(circle at 35% 20%, rgba(255,215,0,0.10), transparent 42%),
        radial-gradient(circle at 75% 35%, rgba(255,215,0,0.06), transparent 40%),
        radial-gradient(circle at top, #16161a 0%, #050507 55%, #000 100%);
    }

    .container{
      max-width: 1180px;
      margin: 0 auto;
      padding: 28px 22px 34px;
    }

    /* Top nav */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 14px;
      margin-bottom: 22px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding: 9px 12px;
      border-radius: 999px;
      background: rgba(255,215,0,0.08);
      border: 1px solid rgba(255,215,0,0.22);
      color: rgba(255,255,255,0.88);
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.2px;
      user-select:none;
    }

    .pill .dot{
      width: 8px; height: 8px;
      border-radius: 50%;
      background: rgba(255,215,0,0.85);
      box-shadow: 0 0 10px rgba(255,215,0,0.45);
    }

    .navbtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,215,0,0.22);
      background: rgba(255,215,0,0.06);
      color: rgba(255,255,255,0.9);
      font-weight: 800;
      font-size: 13px;
      cursor:pointer;
      text-decoration:none;
      user-select:none;
      transition: transform 140ms ease, box-shadow 140ms ease, filter 140ms ease, border-color 140ms ease;
    }

    /* Hero grid */
    .hero{
      display:grid;
      grid-template-columns: 1.25fr 0.95fr;
      gap: 18px;
      align-items: start;
      margin-bottom: 18px;
    }

    @media (max-width: 980px){
      .hero{ grid-template-columns: 1fr; }
    }

    .heroLeft{
      position:relative;
      min-height: 360px;
      padding: 18px 0 0;
    }
    .heroLeft h1{
      margin: 8px 0 10px;
      font-size: clamp(36px, 4.2vw, 56px);
      font-weight: 900;
      letter-spacing: 0.4px;
      line-height: 0.98;
      background: linear-gradient(
        105deg,
        rgba(255,255,255,0.82) 0%,
        rgba(255,215,0,0.72) 14%,
        rgba(255,255,255,1.00) 26%,
        rgba(255,231,120,0.96) 38%,
        rgba(255,255,255,0.95) 52%,
        rgba(255,215,0,0.78) 66%,
        rgba(255,255,255,0.82) 80%
      );
      background-size: 240% 100%;
      background-position: 200% 50%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow:
        0 0 8px rgba(255,215,0,0.16),
        0 0 18px rgba(255,215,0,0.18),
        0 0 34px rgba(255,180,0,0.14),
        0 2px 0 rgba(0,0,0,0.35);
      position: relative;
      animation: heroGoldPulse 2.6s ease-in-out infinite, heroHeadlineShimmer 3.2s linear infinite;
    }

    .heroLeft h1::after{
      content: "";
      position: absolute;
      inset: -8px -12px;
      pointer-events: none;
      border-radius: 12px;
      background:
        radial-gradient(
          circle at 50% 55%,
          rgba(255,215,0,0.12) 0%,
          rgba(255,215,0,0.06) 35%,
          rgba(255,215,0,0.00) 70%
        );
      filter: blur(10px);
      opacity: 0.9;
      animation: heroGoldPulse 2.6s ease-in-out infinite;
      z-index: -1;
    }
    @keyframes heroGoldPulse {
      0%, 100% { opacity: 0.65; transform: scale(0.985); }
      50%      { opacity: 1;    transform: scale(1.015); }
    }

    @keyframes heroHeadlineShimmer {
      0% { background-position: 220% 50%; }
      100% { background-position: -20% 50%; }
    }

    .lead{
      margin: 0 0 14px;
      max-width: 560px;
      color: var(--muted);
      font-size: 15.5px;
      line-height: 1.5;
    }

    .ctaRow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 14px 0 10px;
      justify-content: flex-start;
    }

    .btn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 11px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,215,0,0.35);
      font-weight: 900;
      font-size: 13px;
      letter-spacing: 0.2px;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
      transition: transform 140ms ease, box-shadow 140ms ease, filter 140ms ease, border-color 140ms ease;
    }

    .btnPrimary{
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      color: #0a0a0a;
    }

    .btnGhost{
      background: rgba(255,255,255,0.04);
      color: rgba(255,255,255,0.9);
      border: 1px solid rgba(255,255,255,0.10);
    }

    /* ===== Glow for ALL buttons (hover + pressed) ===== */
    .btn:hover, .navbtn:hover, button:hover{
      transform: translateY(-2px);
      filter: brightness(1.05);
      box-shadow:
        0 14px 34px rgba(0,0,0,0.55),
        0 0 26px rgba(255,215,0,0.28),
        0 0 60px rgba(255,215,0,0.14);
      border-color: rgba(255,215,0,0.55);
    }
    .btn:active, .navbtn:active, button:active{
      transform: translateY(0px) scale(0.985);
      filter: brightness(0.98);
      box-shadow:
        0 10px 24px rgba(0,0,0,0.60),
        0 0 34px rgba(255,215,0,0.40),
        0 0 80px rgba(255,215,0,0.18);
      border-color: rgba(255,215,0,0.75);
    }
    .btn:focus-visible, .navbtn:focus-visible, button:focus-visible{
      outline: none;
      box-shadow:
        0 0 0 4px rgba(255,215,0,0.18),
        0 0 28px rgba(255,215,0,0.26),
        0 18px 40px rgba(0,0,0,0.55);
    }

    .subNote{
      display: block;
      width: 100%;
      max-width: none;
      margin: 14px 0 0;
      text-align: left;

      font-size: 15px;
      font-weight: 900;
      letter-spacing: 0.7px;
      line-height: 1.15;
      position: relative;

      background: linear-gradient(
        105deg,
        rgba(255,255,255,0.22) 0%,
        rgba(255,215,0,0.70) 14%,
        rgba(255,255,255,1.00) 24%,
        rgba(255,231,120,0.98) 32%,
        rgba(255,255,255,0.95) 40%,
        rgba(255,215,0,0.78) 52%,
        rgba(255,255,255,0.22) 66%
      );
      background-size: 260% 100%;
      background-position: 180% 50%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;

      text-shadow:
        0 0 8px rgba(255,215,0,0.12),
        0 0 18px rgba(255,215,0,0.16),
        0 0 30px rgba(255,215,0,0.12);

      animation: truthShimmer 2.4s linear infinite;
    }

    @keyframes truthShimmer {
      0%   { background-position: 220% 50%; }
      100% { background-position: -30% 50%; }
    }
    @media (max-width: 640px){
      .heroLeft h1{
        text-shadow:
          0 0 6px rgba(255,215,0,0.16),
          0 0 14px rgba(255,215,0,0.16),
          0 0 24px rgba(255,180,0,0.12),
          0 2px 0 rgba(0,0,0,0.35);
        animation: heroGoldPulse 2.6s ease-in-out infinite, heroHeadlineShimmer 3.8s linear infinite;
      }

      .subNote{
        font-size: 13px;
        letter-spacing: 0.45px;
        margin-top: 12px;
      }
    }
   /* Center the hero logo */
.hero-logo-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
  margin: 18px 0 34px 0; /* spacing above/below logo */
}

.brandLogo {
  width: 1320px;           /* adjust size */
  max-width: 60vw;        /* responsive */
  height: auto;
  opacity: 0.98;
  filter: drop-shadow(0 0 34px rgba(255,215,0,0.24));
  pointer-events: none;
}


/* Adjust for smaller laptops */
@media (max-width: 1200px) {
  .brandLogo { 
    width: 420px; 
    left: 10px;        /* Keeping it on the left */
    right: auto; 
    top: 175px; 
  }
}

    /* Right run card */
    .runCard{
      background: rgba(22,22,26,0.72);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      padding: 16px;
      box-shadow: var(--shadow);
    }

    .runTitle{
      font-weight: 950;
      margin: 0 0 6px;
      font-size: 15px;
    }

    .runDesc{
      margin: 0 0 12px;
      color: rgba(255,255,255,0.65);
      font-size: 12.5px;
      line-height: 1.4;
    }

    label{
      display:block;
      font-size: 11px;
      font-weight: 900;
      letter-spacing: 0.8px;
      color: rgba(255,215,0,0.82);
      margin: 10px 0 6px;
    }

    .input, select{
      width:100%;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(12,12,16,0.85);
      color: rgba(255,255,255,0.92);
      outline: none;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }

    .runBtn{
      width:100%;
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,215,0,0.35);
      background: linear-gradient(180deg, var(--gold), var(--gold2));
      color: #0a0a0a;
      font-weight: 950;
      letter-spacing: 0.2px;
      cursor:pointer;
      transition: transform 140ms ease, box-shadow 140ms ease, filter 140ms ease, border-color 140ms ease;
    }

    .teaserForm{ margin: 0; }

    .urlAssist{
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(12,12,16,0.72);
    }
    .urlAssist[hidden]{ display:none; }
    .assistGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 8px;
    }
    .assistLabel{
      font-size: 10.5px;
      font-weight: 900;
      letter-spacing: 0.6px;
      color: rgba(255,255,255,0.58);
      text-transform: uppercase;
    }
    .assistValue{
      font-size: 12.5px;
      color: rgba(255,255,255,0.92);
      word-break: break-all;
    }
    .assistActions{
      margin-top: 10px;
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }
    .assistBtn{
      border: 1px solid rgba(255,215,0,0.28);
      border-radius: 10px;
      background: rgba(255,215,0,0.08);
      color: rgba(255,255,255,0.90);
      font-size: 11.5px;
      font-weight: 800;
      padding: 8px 10px;
      cursor: pointer;
    }
    .assistBtn[disabled]{
      opacity: 0.55;
      cursor: not-allowed;
    }
    .assistHint{
      font-size: 11.5px;
      color: rgba(255,255,255,0.62);
    }

    .resultBox{
      margin-top: 12px;
      padding: 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(12,12,16,0.60);
      color: rgba(255,255,255,0.90);
      font-size: 13px;
      line-height: 1.45;
    }
    .resultHeader{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    .resultVerdict{
      display:inline-flex;
      align-items:center;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 11.5px;
      font-weight: 900;
      letter-spacing: 0.4px;
      border: 1px solid transparent;
    }
    .resultVerdict.pass{
      color: #0f8f4a;
      background: rgba(56,189,120,0.16);
      border-color: rgba(56,189,120,0.36);
    }
    .resultVerdict.fail{
      color: #cc3f49;
      background: rgba(220,70,86,0.16);
      border-color: rgba(220,70,86,0.36);
    }
    .resultVerdict.warn{
      color: #d0ab33;
      background: rgba(255,215,0,0.16);
      border-color: rgba(255,215,0,0.36);
    }
    .resultConfidence{
      color: rgba(255,255,255,0.76);
      font-size: 12px;
      font-weight: 700;
    }
    .resultGrid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
    }
    @media (max-width: 520px){
      .resultGrid{ grid-template-columns: 1fr; }
    }
    .resultCell{
      padding: 8px;
      border-radius: 10px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.06);
    }
    .resultCellLabel{
      display:block;
      font-size: 10.5px;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.58);
      margin-bottom: 2px;
    }
    .resultCellValue{
      font-size: 13px;
      font-weight: 800;
      color: rgba(255,255,255,0.92);
    }
    .resultMeta{
      color: rgba(255,255,255,0.64);
      font-size: 12px;
      margin-top: 6px;
    }

    /* Mid cards */
    .midCards{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
      margin: 16px 0 16px;
    }
    @media (max-width: 980px){
      .midCards{ grid-template-columns: 1fr; }
    }

    .infoCard{
      background: rgba(18,18,22,0.58);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
    }

    .infoCard h4{
      margin: 0 0 6px;
      font-size: 13px;
      font-weight: 950;
    }

    .infoCard p{
      margin:0;
      color: rgba(255,255,255,0.65);
      font-size: 12.5px;
      line-height: 1.45;
    }

    /* Pricing */
    .pricingWrap{ margin-top: 8px; }
    .pricingTitle{
      margin: 10px 0 6px;
      font-size: 18px;
      font-weight: 950;
    }
    .pricingSub{
      margin: 0 0 10px;
      color: rgba(255,255,255,0.62);
      font-size: 12.5px;
    }

    .pricingFYI{
      margin: 0 0 12px;
      color: rgba(255,255,255,0.55);
      font-size: 12px;
      line-height: 1.45;
    }
    .pricingFYI strong{ color: rgba(255,255,255,0.82); }
    .pricingFYI .gold{ color: rgba(255,215,0,0.9); font-weight: 900; }

    .pricingGrid{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 14px;
    }
    @media (max-width: 980px){
      .pricingGrid{ grid-template-columns: 1fr; }
    }

    .priceCard{
      background: rgba(18,18,22,0.58);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 14px 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.35);
      transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
      cursor: pointer;
      user-select:none;
    }

    .priceCard:hover{
      transform: translateY(-3px);
      border-color: rgba(255,215,0,0.28);
      box-shadow: 0 16px 38px rgba(0,0,0,0.50), 0 0 22px rgba(255,215,0,0.12);
    }

    .priceCard:active{
      transform: translateY(-1px) scale(0.995);
      border-color: rgba(255,215,0,0.48);
      box-shadow: 0 18px 44px rgba(0,0,0,0.60), 0 0 28px rgba(255,215,0,0.18);
    }

    .priceCard h5{
      margin:0 0 8px;
      font-size: 13px;
      font-weight: 950;
    }
    .priceBig{
      margin:0 0 6px;
      font-size: 22px;
      font-weight: 950;
      color: rgba(255,215,0,0.92);
    }
    .priceDesc{
      margin:0;
      color: rgba(255,255,255,0.62);
      font-size: 12px;
      line-height: 1.45;
    }

    .footer{
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.06);
      display:flex;
      justify-content: space-between;
      gap: 10px;
      color: rgba(255,255,255,0.45);
      font-size: 12px;
      flex-wrap: wrap;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="topbar">
      <div class="pill"><span class="dot"></span> Payment never changes truth</div>
      <a class="navbtn" href="#pricing">Pricing</a>
    </div>

    <section class="hero">
      <div class="heroLeft">
        <h1>Verify Before You Buy</h1>
        <p class="lead">
          Garnett Work checks the live market before you commit so you can catch overpriced deals early.
          Start with a free teaser verdict first, then unlock the full proof only when you need it.
        </p>

        <div class="ctaRow">
          <a class="btn btnPrimary" href="#run">Get Free Teaser Verdict</a>
          <a class="btn btnGhost" href="#how">How it works</a>
        </div>

        <div class="subNote">Hype sells. Truth pays.</div>

       <div class="hero-logo-wrapper">
  <img class="brandLogo" src="logo.png" alt="Garnett Work logo" />
</div>
    </div>

      <div class="runCard" id="run">
        <div class="runTitle">Run Garnett</div>
        <div class="runDesc">
          Paste a listing URL or item ID with deal details to get a free teaser verdict before you overpay.
        </div>

        <form id="teaser-form" class="teaserForm" novalidate>
          <label for="listing-url">LISTING URL OR ITEM ID</label>
          <input id="listing-url" class="input" placeholder="https://www.ebay.com/itm/... or 12-digit ID" />

          <div class="urlAssist" id="urlAssist" hidden>
            <div class="assistGrid">
              <div>
                <div class="assistLabel">Detected Item ID</div>
                <div class="assistValue" id="detected-item-id">-</div>
              </div>
              <div>
                <div class="assistLabel">Canonical URL</div>
                <div class="assistValue" id="canonical-url">-</div>
              </div>
            </div>
            <div class="assistActions">
              <button id="copy-canonical" class="assistBtn" type="button" disabled>Copy canonical URL</button>
              <span id="url-assist-hint" class="assistHint">Paste a full /itm URL or a 12-digit item ID.</span>
            </div>
          </div>

          <div class="row2">
            <div>
              <label for="buy-price">BUY PRICE</label>
              <input id="buy-price" class="input" placeholder="$" />
            </div>
            <div>
              <label for="condition">CONDITION</label>
              <select id="condition">
                <option>Used</option>
                <option>Open Box</option>
                <option>New</option>
              </select>
            </div>
          </div>

          <button id="run-btn" class="runBtn" type="submit">Get Free Teaser Verdict</button>
        </form>
        <div id="teaser-result" class="resultBox" aria-live="polite">Ready.</div>
      </div>
    </section>

    <section class="midCards" id="how">
      <div class="infoCard">
        <h4>Free Teaser</h4>
        <p>Instant PASS/FAIL + headline numbers. No sensitive details. Fast triage.</p>
      </div>
      <div class="infoCard">
        <h4>Truth Packet (Paid)</h4>
        <p>Comps, fee math, rules fired, and a decision receipt. Proof you can trust.</p>
      </div>
    </section>

    <section class="pricingWrap" id="pricing">
      <div class="pricingTitle">Pricing</div>

      <div class="pricingSub">
        Stop guessing. Verify the real market price before you buy — so you don’t get stuck holding a loss.
      </div>

      <div class="pricingFYI">
        <strong>FYI:</strong> <span class="gold">Teaser</span> = signal. <span class="gold">Unlock</span> = proof.
        <strong>Payment never changes truth</strong> — it only unlocks detail.
        <br><strong>Payments accepted:</strong> Lightning (BTC) • Card (Stripe)
      </div>

      <div class="pricingGrid">
        <div class="priceCard" tabindex="0" role="button">
          <h5>Free Teaser</h5>
          <div class="priceBig">FREE</div>
          <p class="priceDesc">Unlimited basic verdicts + headline numbers.</p>
        </div>

        <div class="priceCard" tabindex="0" role="button">
          <h5>Single Unlock</h5>
          <div class="priceBig">$0.25</div>
          <p class="priceDesc">Unlock one full Truth Packet (comps, math, rules fired, receipt).</p>
        </div>

        <div class="priceCard" tabindex="0" role="button">
          <h5>Starter</h5>
          <div class="priceBig">$10/mo</div>
          <p class="priceDesc">50 unlocks included. $0.20 each extra. Saved history.</p>
        </div>
      </div>

      <div class="pricingSub" style="margin-top:10px;">
        Pro/Team/Enterprise tiers can be added after repeat users exist.
      </div>
    </section>

    <div class="footer">
      <div>© 2026 Garnett Work</div>
      <div>Truth decides. Payment only unlocks detail.</div>
    </div>
  </div>
 <script>
(() => {
  const form = document.getElementById("teaser-form");
  if (!form || form.dataset.bound === "true") return;
  form.dataset.bound = "true";

  const urlInput = document.getElementById("listing-url");
  const priceInput = document.getElementById("buy-price");
  const conditionSelect = document.getElementById("condition");
  const runBtn = document.getElementById("run-btn");
  const resultBox = document.getElementById("teaser-result");
  const urlAssist = document.getElementById("urlAssist");
  const detectedItemIdEl = document.getElementById("detected-item-id");
  const canonicalUrlEl = document.getElementById("canonical-url");
  const copyCanonicalBtn = document.getElementById("copy-canonical");
  const urlAssistHint = document.getElementById("url-assist-hint");

  const LOCAL_API_URL = "http://localhost:8080/teaser";
  const CLOUD_RUN_API_URL = "https://garnett-teaser-204821439481.us-central1.run.app/teaser";
  const host = window.location.hostname.toLowerCase();
  const isLocal = host === "localhost" || host === "127.0.0.1";
  const API_URL = isLocal ? LOCAL_API_URL : CLOUD_RUN_API_URL;

  function escapeHtml(value) {
    return String(value ?? "")
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#39;");
  }

  function money(value) {
    const num = Number(value);
    if (!Number.isFinite(num)) return "N/A";
    return num.toLocaleString(undefined, { style: "currency", currency: "USD" });
  }

  function parsePrice(value) {
    const normalized = String(value || "").replace(/[^0-9.]/g, "");
    const buy = Number(normalized);
    if (!Number.isFinite(buy) || buy <= 0) return null;
    return buy;
  }

  function canonicalUrlFromItemId(itemId) {
    return `https://www.ebay.com/itm/${itemId}`;
  }

  function parseListingInput(value) {
    const raw = String(value || "").trim();
    if (!raw) {
      return { ok: false, helper: "Paste a full /itm URL or a 12-digit item ID." };
    }

    const idOnly = raw.match(/^\d{12}$/);
    if (idOnly) {
      return {
        ok: true,
        itemId: idOnly[0],
        canonicalUrl: canonicalUrlFromItemId(idOnly[0]),
        helper: "Raw 12-digit item ID detected.",
      };
    }

    let candidate = raw;
    if (!/^https?:\/\//i.test(candidate)) {
      candidate = `https://${candidate}`;
    }

    let parsedUrl;
    try {
      parsedUrl = new URL(candidate);
    } catch (_error) {
      const looseId = raw.match(/\b(\d{12})\b/);
      if (looseId) {
        return {
          ok: true,
          itemId: looseId[1],
          canonicalUrl: canonicalUrlFromItemId(looseId[1]),
          helper: "12-digit item ID detected.",
        };
      }
      return { ok: false, helper: "Paste a valid eBay /itm URL or 12-digit item ID." };
    }

    const hostname = parsedUrl.hostname.toLowerCase();
    const searchable = `${parsedUrl.pathname}${parsedUrl.search}${parsedUrl.hash}`;
    const isEbayShort = hostname === "ebay.us" || hostname.endsWith(".ebay.us");
    const isEbayHost =
      hostname === "ebay.com" ||
      hostname.endsWith(".ebay.com") ||
      hostname === "www.ebay.ca" ||
      hostname.endsWith(".ebay.ca") ||
      hostname.includes("ebay.");

    if (isEbayShort) {
      const shortId = searchable.match(/\b(\d{12})\b/);
      if (shortId) {
        return {
          ok: true,
          itemId: shortId[1],
          canonicalUrl: canonicalUrlFromItemId(shortId[1]),
          helper: "ebay.us short link with item ID detected.",
        };
      }
      return {
        ok: false,
        helper: "Detected ebay.us short link. Open it once, then paste the final /itm URL or 12-digit item ID.",
      };
    }

    if (!isEbayHost) {
      return { ok: false, helper: "Use an eBay item link or a 12-digit item ID." };
    }

    const itemMatch =
      searchable.match(/\/itm\/(?:[^/?#]+\/)?(\d{12})(?:[/?#]|$)/i) ||
      searchable.match(/\/itm\/(\d{12})(?:[/?#]|$)/i) ||
      searchable.match(/[?&](?:item|itemid|itm)=(\d{12})(?:&|$)/i) ||
      searchable.match(/\b(\d{12})\b/);

    if (!itemMatch) {
      return { ok: false, helper: "Could not detect a 12-digit item ID from that URL." };
    }

    return {
      ok: true,
      itemId: itemMatch[1],
      canonicalUrl: canonicalUrlFromItemId(itemMatch[1]),
      helper: "eBay listing URL detected.",
    };
  }

  function renderResultMessage(message) {
    resultBox.innerHTML = `<div>${escapeHtml(message)}</div>`;
  }

  function renderResultError(message) {
    resultBox.innerHTML = `<div style="color:#ff8f96;font-weight:700;">${escapeHtml(message)}</div>`;
  }

  function renderDebugDetails(debugPayload) {
    const debugJson = escapeHtml(JSON.stringify(debugPayload || {}, null, 2));
    return `
      <details style="margin-top:10px;">
        <summary style="cursor:pointer;color:rgba(255,255,255,0.78);font-weight:700;">Debug</summary>
        <pre style="margin-top:8px;padding:10px;border-radius:10px;background:rgba(0,0,0,0.28);border:1px solid rgba(255,255,255,0.08);color:rgba(255,255,255,0.80);overflow:auto;font-size:11.5px;line-height:1.35;">${debugJson}</pre>
      </details>
    `;
  }

  function renderBackendError(data, parsedListing) {
    const reason = escapeHtml(data?.reason || "UNKNOWN");
    const errorMsg = escapeHtml(data?.error || "No backend error message returned.");
    const retryAfterSec = Number(data?.retryAfterSec);
    const retryText =
      Number.isFinite(retryAfterSec) && retryAfterSec > 0
        ? `${retryAfterSec}s (~${(retryAfterSec / 60).toFixed(1)} min)`
        : "N/A";
    const titleSource = escapeHtml(data?.debug?.titleSource || "N/A");
    const itemId = escapeHtml(data?.itemId || parsedListing?.itemId || "-");

    resultBox.innerHTML = `
      <div class="resultHeader">
        <span class="resultVerdict warn">${reason}</span>
        <span class="resultConfidence">Backend returned ok=false</span>
      </div>
      <div class="resultGrid">
        <div class="resultCell">
          <span class="resultCellLabel">Item ID</span>
          <span class="resultCellValue">${itemId}</span>
        </div>
        <div class="resultCell">
          <span class="resultCellLabel">Retry After</span>
          <span class="resultCellValue">${escapeHtml(retryText)}</span>
        </div>
        <div class="resultCell">
          <span class="resultCellLabel">Title Source</span>
          <span class="resultCellValue">${titleSource}</span>
        </div>
      </div>
      <div class="resultMeta"><strong style="color:rgba(255,255,255,0.82)">Error:</strong> ${errorMsg}</div>
      ${renderDebugDetails(data?.debug || {})}
    `;
  }

  function renderResultData(data, parsedListing) {
    const verdict = String(data?.verdict || "CHECK").toUpperCase();
    const verdictClass = verdict === "PASS" ? "pass" : verdict === "FAIL" ? "fail" : "warn";
    const confidence = escapeHtml(data?.confidence || "N/A");
    const marketPrice = money(data?.marketPrice);
    const buyPrice = money(data?.buyPrice);
    const marginPct = Number(data?.marginPct);
    const marginText = Number.isFinite(marginPct) ? `${marginPct.toFixed(0)}%` : "N/A";
    const compsCount = Number(data?.compsCount);
    const compsText = Number.isFinite(compsCount) ? String(compsCount) : "N/A";
    const conditionText = data?.condition ? escapeHtml(data.condition) : "";
    const itemId = escapeHtml(data?.itemId || parsedListing?.itemId || "-");
    const titleSource = data?.debug?.titleSource ? escapeHtml(data.debug.titleSource) : "";
    const title = data?.title ? escapeHtml(data.title) : "";
    const why = data?.why ? escapeHtml(data.why) : "";

    resultBox.innerHTML = `
      <div class="resultHeader">
        <span class="resultVerdict ${verdictClass}">${escapeHtml(verdict)}</span>
        <span class="resultConfidence">Confidence: ${confidence}</span>
      </div>
      <div class="resultGrid">
        <div class="resultCell">
          <span class="resultCellLabel">Market</span>
          <span class="resultCellValue">${marketPrice}</span>
        </div>
        <div class="resultCell">
          <span class="resultCellLabel">Buy</span>
          <span class="resultCellValue">${buyPrice}</span>
        </div>
        <div class="resultCell">
          <span class="resultCellLabel">Margin</span>
          <span class="resultCellValue">${escapeHtml(marginText)}</span>
        </div>
        <div class="resultCell">
          <span class="resultCellLabel">Comps</span>
          <span class="resultCellValue">${escapeHtml(compsText)}</span>
        </div>
        ${conditionText ? `
        <div class="resultCell">
          <span class="resultCellLabel">Condition</span>
          <span class="resultCellValue">${conditionText}</span>
        </div>` : ""}
      </div>
      <div class="resultMeta">Item ID: ${itemId}</div>
      ${titleSource ? `<div class="resultMeta">Title Source: ${titleSource}</div>` : ""}
      ${title ? `<div class="resultMeta">${title}</div>` : ""}
      ${why ? `<div class="resultMeta">${why}</div>` : ""}
      ${renderDebugDetails(data?.debug || {})}
    `;
  }

  function updateUrlAssist() {
    const parsed = parseListingInput(urlInput.value);
    const hasInput = String(urlInput.value || "").trim().length > 0;

    if (!hasInput) {
      urlAssist.hidden = true;
      copyCanonicalBtn.dataset.canonicalUrl = "";
      copyCanonicalBtn.disabled = true;
      return parsed;
    }

    urlAssist.hidden = false;
    detectedItemIdEl.textContent = parsed.ok ? parsed.itemId : "-";
    canonicalUrlEl.textContent = parsed.ok ? parsed.canonicalUrl : "-";
    urlAssistHint.textContent = parsed.helper;
    copyCanonicalBtn.dataset.canonicalUrl = parsed.ok ? parsed.canonicalUrl : "";
    copyCanonicalBtn.disabled = !parsed.ok;
    return parsed;
  }

  copyCanonicalBtn.addEventListener("click", async () => {
    const canonicalUrl = copyCanonicalBtn.dataset.canonicalUrl || "";
    if (!canonicalUrl) return;
    try {
      await navigator.clipboard.writeText(canonicalUrl);
      urlAssistHint.textContent = "Canonical URL copied.";
    } catch (_error) {
      urlAssistHint.textContent = "Copy failed in this browser. Copy the canonical URL manually.";
    }
  });

  urlInput.addEventListener("input", updateUrlAssist);

  form.addEventListener("submit", async (event) => {
    event.preventDefault();

    const parsedListing = updateUrlAssist();
    if (!parsedListing.ok) {
      renderResultError(parsedListing.helper);
      return;
    }

    const buyPrice = parsePrice(priceInput.value);
    if (!buyPrice) {
      renderResultError("Enter a valid buy price.");
      return;
    }

    const condition = String(conditionSelect?.value || "unknown").trim() || "unknown";

    runBtn.disabled = true;
    runBtn.textContent = "Running...";
    renderResultMessage("Checking the market...");

    try {
      console.info("[Teaser] Request URL:", API_URL);
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          listingUrl: parsedListing.canonicalUrl,
          buyPrice,
          condition,
        }),
      });

      console.info("[Teaser] Response status:", response.status);
      const data = await response.json().catch(() => null);
      console.info("[Teaser] Parsed JSON response:", data);
      if (!response.ok) {
        throw new Error(data?.error || `Request failed (${response.status})`);
      }

      if (!data || data.ok === false) {
        renderBackendError(data || {}, parsedListing);
        return;
      }

      renderResultData(data, parsedListing);
    } catch (error) {
      renderResultError(error?.message || "Unexpected error while calling teaser API.");
    } finally {
      runBtn.disabled = false;
      runBtn.textContent = "Get Free Teaser Verdict";
    }
  });
})();
</script>

</body>
</html>
